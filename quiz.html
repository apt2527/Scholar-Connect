<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz - ScholarConnect</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- NAV -->
  <header class="navbar">
    <div class="container nav-inner">
      <div class="logo">
        <span class="logo-icon"><a href="index.html"><img src="ASSETS/LOGO.jpg" alt="LOGO" style="width:70px;"></a></span>
        <span class="logo-text"><a href="index.html">ScholarConnect</a></span>
      </div>

      <nav class="nav-links">
        <a href="index.html#home">Home</a>
        <a href="scholarships.html">Scholarships</a>
        <a href="categories.html">Categories</a>
        <a href="documents.html">Documents</a>
        <a href="support.html">Support</a>
        <a href="about.html">About</a>
      </nav>

      <div class="nav-actions" id="nav-auth-actions">
        <a id="hdr-login" href="login.html?next=quiz.html" class="btn btn-outline">Login</a>
        <a id="hdr-signup" href="signup.html?next=quiz.html" class="btn btn-primary">Sign up</a>
      </div>
    </div>
  </header>

  <section class="section">
    <div class="container" style="max-width:820px;margin:0 auto;">
      <div class="card quiz-card">
        <h2 style="margin-bottom:6px;">Quick 5-question eligibility quiz</h2>
        <p class="page-subtitle">One question at a time — answer honestly to get personalised scholarship matches.</p>

        <!-- Inline auth banner (non-modal) -->
        <div id="auth-banner" class="auth-banner" style="display:none;">
          <div>
            <strong>Sign in to save your quiz & get personalised matches.</strong>
            <div class="small" style="margin-top:4px;color:#92400e;">This is a demo sign-in that stores a local account (no server).</div>
          </div>
          <div class="actions">
            <a href="login.html?next=quiz.html" class="btn-ghost">Login</a>
            <a href="signup.html?next=quiz.html" class="btn-primary">Sign up</a>
          </div>
        </div>

        <!-- greeting (signed in) -->
        <div id="greeting-area"></div>

        <div class="quiz-wrap">
          <form id="quiz-form" action="javascript:void(0);">
            <!-- STEP 1 -->
            <input class="step-input" id="step-1" name="step" type="radio" checked>
            <div class="step-card">
              <div class="question-head">
                <span>1. What is your current level of study?</span>
                <span class="small">Step 1 of 5</span>
              </div>
              <div class="options">
                <label class="option-item"><input name="level" type="radio" value="class9-12"> <span>Class 9–12</span></label>
                <label class="option-item"><input name="level" type="radio" value="undergrad"> <span>Undergraduate</span></label>
                <label class="option-item"><input name="level" type="radio" value="postgrad"> <span>Postgraduate / Research</span></label>
              </div>
              <div class="quiz-nav" style="margin-top:12px;">
                <label for="step-2" class="btn-ghost">Next →</label>
              </div>
            </div>

            <!-- STEP 2 -->
            <input class="step-input" id="step-2" name="step" type="radio">
            <div class="step-card">
              <div class="question-head">
                <span>2. Which field are you pursuing or planning?</span>
                <span class="small">Step 2 of 5</span>
              </div>
              <div class="options">
                <label class="option-item"><input name="field" type="radio" value="engineering"> <span>Engineering / Technology</span></label>
                <label class="option-item"><input name="field" type="radio" value="science"> <span>Basic & Natural Sciences</span></label>
                <label class="option-item"><input name="field" type="radio" value="commerce"> <span>Commerce / Arts / Management</span></label>
                <label class="option-item"><input name="field" type="radio" value="other"> <span>Other / Professional</span></label>
              </div>
              <div class="quiz-nav">
                <label for="step-1" class="btn-ghost">← Back</label>
                <label for="step-3" class="btn-ghost">Next →</label>
              </div>
            </div>

            <!-- STEP 3 -->
            <input class="step-input" id="step-3" name="step" type="radio">
            <div class="step-card">
              <div class="question-head">
                <span>3. Is your family income below ₹8 lakh per year?</span>
                <span class="small">Step 3 of 5</span>
              </div>
              <div class="options">
                <label class="option-item"><input name="income" type="radio" value="yes"> <span>Yes</span></label>
                <label class="option-item"><input name="income" type="radio" value="no"> <span>No</span></label>
              </div>
              <div class="quiz-nav">
                <label for="step-2" class="btn-ghost">← Back</label>
                <label for="step-4" class="btn-ghost">Next →</label>
              </div>
            </div>

            <!-- STEP 4 -->
            <input class="step-input" id="step-4" name="step" type="radio">
            <div class="step-card">
              <div class="question-head">
                <span>4. Identify your gender (for gender-targeted schemes)</span>
                <span class="small">Step 4 of 5</span>
              </div>
              <div class="options">
                <label class="option-item"><input name="gender" type="radio" value="female"> <span>Female</span></label>
                <label class="option-item"><input name="gender" type="radio" value="male"> <span>Male</span></label>
                <label class="option-item"><input name="gender" type="radio" value="other"> <span>Prefer not to say</span></label>
              </div>
              <div class="quiz-nav">
                <label for="step-3" class="btn-ghost">← Back</label>
                <label for="step-5" class="btn-ghost">Next →</label>
              </div>
            </div>

            <!-- STEP 5 -->
            <input class="step-input" id="step-5" name="step" type="radio">
            <div class="step-card">
              <div class="question-head">
                <span>5. Have you scored in the top 1% or got a top rank in board/JEE/other national exams?</span>
                <span class="small">Step 5 of 5</span>
              </div>
              <div class="options">
                <label class="option-item"><input name="merit" type="radio" value="top"> <span>Yes — top ranks / top 1%</span></label>
                <label class="option-item"><input name="merit" type="radio" value="nope"> <span>No</span></label>
              </div>

              <div class="quiz-nav">
                <label for="step-4" class="btn-ghost">← Back</label>
                <button id="finish-quiz" class="btn-primary" type="button">Get personalised matches</button>
              </div>
            </div>
          </form>

          <div class="progress" aria-hidden="true">
            <span class="dot" id="dot-1"></span>
            <span class="dot" id="dot-2"></span>
            <span class="dot" id="dot-3"></span>
            <span class="dot" id="dot-4"></span>
            <span class="dot" id="dot-5"></span>
          </div>

          <div id="results" class="results" aria-live="polite"></div>
        </div>
      </div>
    </div>
  </section>

  <footer class="simple-footer">
    <div class="container simple-footer-inner">
      <p class="footer-brand">ScholarConnect</p>
      <p class="footer-copy">© 2025 ScholarConnect • All rights reserved.</p>
    </div>
  </footer>

  <script>
    // Minimal JS: auth header, hide banner when signed in, compute results, update progress dots, sign-out.
    function getUser(){ return JSON.parse(localStorage.getItem('sc_user') || 'null'); }
    function signedIn(){ return !!localStorage.getItem('sc_user'); }
    function signOut(){ localStorage.removeItem('sc_user'); location.reload(); }
    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    const SCH_MAP = {
      nsp: { title:'National Scholarship Portal (NSP)', verified:true },
      'central-sector': { title:'PM-USP Central Sector Scheme (CSSS)', verified:true },
      'aicte-pragati': { title:'AICTE Pragati Scholarship (Girls)', verified:true },
      inspire: { title:'INSPIRE (DST) — SHE', verified:true },
      pmss: { title:"Prime Minister's Scholarship Scheme (PMSS)", verified:true },
      'kotak-kanya': { title:'Kotak Kanya Scholarship', verified:false },
      'lic-hfl': { title:'LIC HFL Vidyadhan', verified:false },
      'hdfc-ecss': { title:'HDFC Parivartan ECSS', verified:false },
      'lt-bis': { title:'L&T Build India Scholarship (BIS)', verified:false },
      manf: { title:'Maulana Azad National Fellowship (MANF) — note', verified:false }
    };

    function renderAuthHeader(){
      const navAuth = document.getElementById('nav-auth-actions');
      if(signedIn()){
        const user = getUser();
        navAuth.innerHTML = `<div style="display:flex;gap:10px;align-items:center;"><span class="small">Signed in as <strong>${escapeHtml(user.name||user.email)}</strong></span><a id="signout-btn" href="#" class="btn btn-outline">Sign out</a></div>`;
        document.getElementById('signout-btn').addEventListener('click', function(e){ e.preventDefault(); if(confirm('Sign out?')) signOut(); });
      } else {
        navAuth.innerHTML = `<a href="login.html?next=quiz.html" class="btn btn-outline">Login</a><a href="signup.html?next=quiz.html" class="btn btn-primary">Sign up</a>`;
      }
    }

    function handleAuthBannerAndGreeting(){
      const banner = document.getElementById('auth-banner');
      const greeting = document.getElementById('greeting-area');
      if(!signedIn()){
        banner.style.display = 'flex'; // show gentle inline banner
        greeting.innerHTML = '';
      } else {
        banner.style.display = 'none';
        const user = getUser();
        greeting.innerHTML = `<div class="card-section small">Signed in as <strong>${escapeHtml(user.name||user.email)}</strong> — (<a href="#" id="logout-inline" class="small-link">Sign out</a>)</div>`;
        document.getElementById('logout-inline').addEventListener('click', function(e){ e.preventDefault(); if(confirm('Sign out?')) signOut(); });
      }
    }

    function updateProgressDots(){
      for(let i=1;i<=5;i++){
        const dot = document.getElementById('dot-'+i);
        const stepInput = document.getElementById('step-'+i);
        if(stepInput && stepInput.checked){
          for(let j=1;j<=5;j++) document.getElementById('dot-'+j).classList.toggle('active', j<=i);
        }
      }
    }

    function computeMatches(answers){
      const matches = [];
      matches.push('nsp');
      if(answers.merit==='top' || answers.level==='undergrad' || answers.level==='postgrad') matches.push('central-sector');
      if(answers.gender==='female' && answers.field==='engineering' && answers.level==='undergrad') matches.push('aicte-pragati');
      if(answers.merit==='top' && answers.field==='science') matches.push('inspire');
      if(answers.level==='postgrad') matches.push('manf');
      if(answers.income==='yes') matches.push('hdfc-ecss','lic-hfl');
      matches.push('pmss');
      return [...new Set(matches)];
    }

    function showResults(ids){
      const out = document.getElementById('results');
      out.innerHTML = '<h3 style="margin-top:12px;">Recommended scholarships</h3>';
      ids.forEach(id=>{
        const s = SCH_MAP[id] || { title:id, verified:false };
        const badge = s.verified ? `<span class="badge-verified">Verified</span>` : `<span class="badge-unverified">Non-verified</span>`;
        const card = document.createElement('div');
        card.className = 'result-card';
        card.innerHTML = `<div><h4 style="margin:0 0 6px 0;">${badge}${escapeHtml(s.title)}</h4><p class="small" style="margin:0">Open the full details on the Scholarships page.</p></div><div style="display:flex;flex-direction:column;gap:8px;"><a class="btn btn-outline" style="white-space:nowrap;" href="scholarships.html#${encodeURIComponent(id)}">View details</a><a class="btn btn-primary" href="index.html">Back to home</a></div>`;
        out.appendChild(card);
      });
      out.innerHTML += '<p class="small" style="margin-top:8px;">Tip: always open the official scheme PDF on the provider portal for the current year before applying.</p>';
      out.scrollIntoView({behavior:'smooth'});
    }

    // init
    window.addEventListener('load', function(){
      renderAuthHeader();
      handleAuthBannerAndGreeting();
      updateProgressDots();

      document.querySelectorAll('.step-input').forEach(inp => inp.addEventListener('change', updateProgressDots));

      document.getElementById('finish-quiz').addEventListener('click', function(){
        // check sign-in
        if(!signedIn()){
          // gentle inline banner remains visible; scroll to it
          document.getElementById('auth-banner').scrollIntoView({behavior:'smooth'});
          return;
        }

        // collect answers
        const form = document.getElementById('quiz-form');
        const vals = {};
        ['level','field','income','gender','merit'].forEach(name=>{
          const sel = form.querySelector(`input[name="${name}"]:checked`);
          vals[name] = sel ? sel.value : null;
        });
        for(const [k,v] of Object.entries(vals)){
          if(!v){ alert('Please answer the missing question.'); return; }
        }

        const matches = computeMatches(vals);
        showResults(matches);

        // store demo quiz locally for convenience
        try { localStorage.setItem('sc_quiz', JSON.stringify({ user:getUser(), answers:vals, matches, at:Date.now() })); } catch(e){}
      });
    });
  </script>
</body>
</html>
